name: MAUI iOS Unsigned IPA Build
on:
  workflow_dispatch:

env:
  DOTNET_VERSION: '9.0.x'
  PROJECT_PATH: 'Test/MyMauiAppIos'
  TARGET_FRAMEWORK: 'net9.0-ios'
  CONFIGURATION: 'Release'

jobs:
  build-ios:
    name: ðŸŽ‰ MAUI iOS Build (Unsigned)
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: List available Xcode versions
        run: ls /Applications | grep Xcode
      
      - name: Set Xcode version
        run: |
          # Check available Xcode versions and select the most appropriate one
          if [ -d "/Applications/Xcode_15.2.app" ]; then
            sudo xcode-select -s /Applications/Xcode_15.2.app
          elif [ -d "/Applications/Xcode_15.1.app" ]; then
            sudo xcode-select -s /Applications/Xcode_15.1.app
          elif [ -d "/Applications/Xcode_15.0.app" ]; then
            sudo xcode-select -s /Applications/Xcode_15.0.app
          elif [ -d "/Applications/Xcode_14.3.1.app" ]; then
            sudo xcode-select -s /Applications/Xcode_14.3.1.app
          elif [ -d "/Applications/Xcode_14.3.app" ]; then
            sudo xcode-select -s /Applications/Xcode_14.3.app
          else
            echo "Using default Xcode"
          fi
          echo "Selected Xcode path:"
          xcode-select -p
          xcodebuild -version
      
      - name: Setup .NET 9
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}
      
      - name: Cache NuGet packages
        uses: actions/cache@v4
        with:
          path: |
            ~/.nuget/packages
            ~/Library/Caches/NuGet
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
